<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <title>业主信息编辑</title>
    <link href="../Content/myStyle.css" rel="stylesheet" />
    <link href="../Content/themes/datepicker.css" rel="stylesheet" />
</head>
<body class="contentbody">
    <!--向导栏-->
    <div class="location">
        <a href="user_list.aspx" class="back"><i></i><span>返回上一页</span></a>
        <a href="../center.aspx" class="home"><i></i><span>首页</span></a>
        <i class="arrow"></i>
        <span>业务管理</span>
        <i class="arrow"></i>
        <span>业主信息</span>
        <i class="arrow"></i>
        <span>编辑信息</span>
    </div>
    <div class="line10"></div>
    <form id="commonForm">
        <div class="content-tab-wrap">
            <div id="floatHead" class="content-tab" style="position: static; top: 52px;">
                <div class="content-tab-ul-wrap">
                    <ul>
                        <li><a href="javascript:;" onclick="tabs(this);" class="selected">基本资料</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-content">
            <dl>
                <dt>账单编号：</dt>
                <dd><span data-bind="text:model().BillNo"></span></dd>
            </dl>
            <dl>
                <dt>账单名称：</dt>
                <dd>
                    <input type="text" data-bind="value:model().BillName" class="input normal" datatype="*2-100" sucmsg=" " errormsg="账单名称至少2个字符,最多100个字符！" nullmsg="请输入账单名称！">
                    <span class="Validform_checktip">* 账单名称，最多255个字符</span>
                </dd>
            </dl>
            <dl>
                <dt>选择小区：</dt>
                <dd>
                    <div class="rule-single-select single-select">
                        <select datatype="*" sucmsg=" " nullmsg="请选择小区！"
                                data-bind="options: xiaoQu,optionsText: 'name',optionsValue: 'Id',value:$root.model().CommuntityId,optionsCaption: ' -- 请选择 -- '"></select>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>选择房间：</dt>
                <dd>
                    <div class="rule-single-select single-select">
                        <select datatype="*" sucmsg=" " nullmsg="请选择小区！"
                                data-bind="options: xiaoQu,optionsText: 'name',optionsValue: 'Id',value:$root.model().RoomId,optionsCaption: ' -- 请选择 -- '"></select>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>金额：</dt>
                <dd>
                    <input type="text" data-bind="value:model().PaymentAmount" class="input normal" datatype="*1-100" sucmsg=" " nullmsg="请输入金额！">
                    <span class="Validform_checktip">* 金额，最多255个字符</span>
                </dd>
            </dl>
            <dl>
                <dt>缴费方式：</dt>
                <dd>
                    <div class="rule-single-select single-select">
                        <select datatype="*" sucmsg=" " nullmsg="请选择缴费方式！" data-bind="value:model().PaymentMethod">
                            <option value="">-- 请选择 --</option>
                            <option value="1">平安代付</option>
                            <option value="2">银行汇款</option>
                            <option value="4">网银支付</option>
                            <option value="5">现金结算</option>
                            <option value="3">POS机</option>
                            <option value="6">其他</option>

                        </select>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>账单状态：</dt>
                <dd>
                    <div class="rule-single-select single-select">
                        <select datatype="*" sucmsg=" " nullmsg="请选择账单状态！" data-bind="value:model().BillStatus">
                            <option value="0">未缴纳</option>
                            <option value="1">已缴纳</option>
                            <option value="2">作废</option>
                        </select>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>缴费时间：</dt>
                <dd>
                    <div class="input-date2 l">
                        <input type="text" id="PaymentDate" data-bind="value:renderDateTime(model().PaymentDate)" class="input date date-time" datatype="/^((?:19|20)\d\d)-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/" errormsg="请选择正确的缴费时间" sucmsg=" ">
                        <i>日期</i>
                    </div>
                    <span class="Validform_checktip">* 缴费时间</span>
                </dd>
            </dl>
            <dl>
                <dt>缴费期限：</dt>
                <dd>
                    <div class="input-date2 l">
                        <input type="text" id="PaymentLastDeadline" data-bind="value:renderDateTime(model().PaymentLastDeadline)" class="input date date-time" datatype="/^\s*$|^\d{4}\-\d{1,2}\-\d{1,2}\s{1}(\d{1,2}:){2}\d{1,2}$/" errormsg="请选择正确的缴费期限" sucmsg=" ">
                        <i>日期</i>
                    </div>
                    <span class="Validform_checktip">* 缴费期限</span>
                </dd>
            </dl>
        </div>
        <div class="line10"></div>
        <div class="page-footer">
            <input type="submit" name="btnSubmit" value="提交保存" id="btnSubmit" class="btn">
            <input name="btnReturn" type="button" value="返回上一页" class="btn yellow" onclick="javascript:history.back(-1);">
        </div>
    </form>
    <script src="../Scripts/Core/jquery-1.8.2.min.js"></script>
    <script src="../Scripts/Core/datepicker.js"></script>
    <script src="../Scripts/Core/jquery-json.js"></script>
    <script src="../Scripts/Plugin/Validform_v5.3.2_min.js"></script>
    <script src="../Scripts/Core/knockout-3.2.0.js"></script>
    <script src="../Scripts/Plugin/lhgdialog/lhgdialog.js"></script>
    <script src="../Scripts/Base/utility.js"></script>
    <script src="../Scripts/Base/common.js"></script>
    <script src="../Scripts/Base/page.js"></script>
    <script type="text/javascript">
        var viewModel = (function () {
            return {
                xiaoQu: ko.observableArray(),
                model: ko.observable({}),

                //时间格式转化
                renderDateTime: function (value) {
                    if (value) {
                        return utility.JsonDateToDateString(value);
                    }
                    return null;
                }
            }
        })();

        $.extend(page, {
            id: 0,
            result: 0,
            init: function () {
                this.id = utility.getQueryString();
                $('#PaymentDate').datepicker($.extend({}, datePickerParam, {
                    onSelect: function (dateText, inst) {
                        viewModel.model().PaymentDate = dateText;
                    }
                }));
                $('#PaymentLastDeadline').datepicker($.extend({}, datePickerParam, {
                    onSelect: function (dateText, inst) {
                        viewModel.model().PaymentLastDeadline = dateText;
                    }
                }));
                page.getXiaoQuSelect();
                this.submitBind();
            },
            getInfo: function () {
                page.executeAjax({
                    url: "../mockdata/zhangdan-info.txt",
                    param: {},
                    success: function (data, param) {
                        viewModel.model(data.info);
                        page.ruleSingleSelect();
                        console.log($("#PaymentDate").val());
                    }
                });
            },
            getXiaoQuSelect: function () {
                page.executeAjax({
                    url: "../mockdata/xiaoqu-list.txt",
                    param: {},
                    success: function (data, param) {
                        viewModel.xiaoQu(data.data);
                        if (utility.getQueryString("id")) {
                            page.getInfo();
                        } else {
                            page.ruleMultiRadio();
                            page.ruleSingleSelect();
                        }
                    }
                });
            },
            submitBind: function () {
                ////初始化表单验证
                this.result = $("#commonForm").initValidform();
                $('#commonForm').on("submit", function () {
                    if (page.result.find(".Validform_error").length > 0) {
                        return false;
                    }
                    console.log(viewModel.model());
                    //ajax add

                    //如下两者提示效果都可，可根据具体需求选择
                    page.dialogTips("发布公告成功！", "Success", "wuye/gonggao-list.html");
                    //base.dialogOK("发布公告成功！", "/wuye/gonggao-list.html");
                    return false;
                });
            }
        });

        $(function () {
            page.init();
            ko.applyBindings(viewModel);
        });
    </script>
</body>
</html>
